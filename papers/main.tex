% !TeX root = main.tex
\documentclass[number,times]{elsarticle}

\input{preamble.tex}

\begin{document}

\title{Resource Adequacy and Operational Security Interaction in the EPOC 2030-50 Project}

\author{Sebastian Gonzato}

\maketitle

\begin{abstract}
    This report outlines an attempt to integrate a resource adequacy and operational security exercise. The idea is to use a unit commitment schedule which is then used as the input to a more detailed power flow model. An additional goal was to make explicit the trade-off between day ahead adequacy and real time reliability. We used an adapted version of KU Leuven's \ac{DUCPR} model which accounts for network constraints in the reserve activation phase for this purpose. However the \ac{DUCPR} model is not able to capture enough detail in the reserve activation phase for this tradeoff to be made. This and other omissions of the \ac{DUCPR} model when compared to the power flow model meant that the load shedding observed in the two models differed by an order of magntiude. All code for the adequacy side of this exercise can be found at \href{https://github.com/junglegobs/ASoSEPOC}{https://github.com/junglegobs/ASoSEPOC}.
\end{abstract}

\newpage

\tableofcontents

\input{acronyms}

\newpage

\section{Interaction description}

Adequacy assessments and operational security analyses are two fundamental exercises in determining and ensuring the reliable operation of the electric power system. The former assesses the ability of the power system to satisfy demand for electricity in the day ahead stage, while the latter assesses (or ensures, depending on the context) that an unexpected event, such as an outage of a transmission line or generator or lower or greater than expected realisation of demand or renewable generation, will lead to cascading failures and a possible blackout.

Typically, these exercises are performed independently. This interaction combines the two by feeding the unit commitment of an adequacy assessment to an operational security analysis which takes these commitments as given.

In doing so, we deviate from typical practices in a number of ways. First, the adequacy assessment was done for a limited number of days instead of many Monte Carlo years for the sake of clarity and brevity. Indeed, doing this exercise for many Monte Carlo years would drastically increase the computational complexity while the aim of this exercise is to illustrate how such an interaction could be performed.

Secondly, we perform the adequacy assessment using an unconventional \ac{UC} model, a modified version of the \ac{DUCPR} model described in~\cite{Bruninx2017}. This model can be seen as a compromise between a computationally expensive stochastic \ac{UC} model and a more tractable though less accurate deterministic \ac{UC} model with operating reserve requirements. The treatment of operating reserves in this model in principle allows a trade-off between shedding load in the day ahead stage, which would reduce day ahead adequacy, and shedding operating reserves, which should reduce operational security. By making this trade-off explicit and verifying the results in an operational security analysis we wished to elaborate on the results of~\cite{Hermans2018}, which did not consider the possibility that shedding operating reserves would lead to insecure operation of the electric power system.

As noted in the abstract, we were unsuccesful in illustrating the value of this interaction for two reasons. Firstly, we were unable to illustrate the tradeoff between adequacy and security with only the \ac{DUCPR} model due to its approximate treatment of real time network imbalances due to reserve activation. Secondly and related, the expected load shedding resulting from the \ac{DUCPR} differed by an order of magnitude to that found by the power flow, likely due to due to the difference in the treatment of storage as well as the more detailed network representation in the power flow model.

All code can be found at \href{https://github.com/junglegobs/ASoSEPOC}{https://github.com/junglegobs/ASoSEPOC}.

The rest of this document is organised as follows. \secref{sec:model} describes the \ac{DUCPR} model used to simulate power system operations and obtain day ahead adequacy and very approximate real time operational security indicators, namely scheduled load shedding and reserve shedding. \secref{sec:data} describes the stylised Belgian system analysed. \secref{sec:initial_results} analyses a single day in order to identify sources of adequacy and security issues, while \secref{sec:adequacy_vs_security} compares the \ac{DUCPR} model results to that of the power flow analysis.

\section{Description of a Deterministic Unit Commitment Model with Probabilistic Reserve (DUC-PR) constraints} \label{sec:model}

\subsection{Sets}

\begin{itemize}
    \item $G$ - Generators
    \item $G_n$ - Generators located at node $n$
    \item $GD$ - Dispatchable / thermal / conventional generators
    \item $GR$ - Renewable / variable generators (\ac{VRES}).
    \item $S$ - Storage technologies
    \item $S$ - Storage technologies located at node $n$
    \item $N$ - Nodes or buses in the network
    \item $B$ - Lines or branches
    \item $T$ - Time steps / intervals / slices
    \item $L^+$ - Upward reserve levels
    \item $L^-$ - Downward reserve levels
\end{itemize}

\subsection{Parameters}

\begin{itemize}
    \item $D_{nt}$ - Demand [MW]
    \item $PTDF_{nl}$ - Power Transfer Distribution Factor [-]
    \item $AF_{gt}$ - Availability Factor [-]
    \item $K_g$ - Capacity [MW]
    \item $P^{min}_g$ - Minimum power output [MW]
    \item $P^{max}_g$ - Maximum power output [MW]
    \item $MUT_g$ - Minimum up time [timesteps]
    \item $MDT_g$ - Minimum down time [timesteps]
    \item $RAMP_g$ - Maximum ramping limit (up and down) [MW/timestep]
    \item $D^{L^+}_{lt}$ - Upward reserve requirement [MW]
    \item $D^{L^-}_{lt}$ - Downward reserve requirement [MW]
    \item $P^{L^+}_{lt}$ - Upward reserve level activation probability [-]
    \item $P^{L^-}_{lt}$ - Downward reserve level activation probability [-]
\end{itemize}

\subsection{Variables}

All variables are positive apart from node injection variables which may also be negative.

\begin{itemize}
    \item $z_{gt}$ - Commitment [-]
    \item $v_{gt}$ - Start up [-]
    \item $w_{gt}$ - Shut down [-]
    \item $q_{gt}$ - Generation [MW]
    \item $\hat{q}_{gt}$ - Generation above the minimum stable operating point (0 in the case of renewables) [MW]
    \item $d_{st}$ - Storage discharge [MW]
    \item $c_{st}$ - Storage charge [MW]
    \item $y_{st}$ - Binary variable, 1 if storage discharges and 0 if it charges [-]
    \item $e_{st}$ - Storage state of charge variable [MWh]
    \item $ls_{nt}$ - Load shedding [MW]
    \item $inj_{nt}$ - Node injection [MW]
    \item $f_{lt}$ - Branch flow [MW]
    \item $r^+_{gt}$ - Total upward reserve provision [MW]
    \item $r^-_{gt}$ - Total downward reserve provision [MW]
    \item $r^{L^+}_{glt}$ - Upward reserve provision for reserve level $l$ [MW]
    \item $r^{L^-}_{glt}$ - Downward reserve provision for reserve level $l$ [MW]
    \item $rs_{nlt}$ - Upward reserve shedding for reserve level $l$ [MW]
    \item $rc_{nlt}$ - Downward reserve provided by day ahead load shedding for reserve level $l$ [MW]
    \item $rinj_{nlt}^{L^+}$ - Possible node injection due to activation of upward reserve level $l$ [MW]
    \item $rinj_{nlt}^{L^-}$ - Possible node injection due to activation of downward reserve level $l$ [MW]
    \item $rf_{nbt}^{L^+}$ - Possible branch flow due to activation of upward reserve level $l$ [MW]
    \item $rf_{nbt}^{L^-}$ - Possible branch flow due to activation of downward reserve level $l$ [MW]
    \item $d_{nlt}^{L^+}$ - Possible imbalance on node $n$ for upward reserve level $l$ [MW]
    \item $d_{nlt}^{L^-}$ - Possible imbalance on node $n$ for downward reserve level $l$ [MW]
\end{itemize}

\subsection{Objective}

Objective is to minimise the sum of all day ahead and real time expected operational costs, the terms of which are defined in the following sections.

\subsubsection{Commitment, start up and shut down costs}

These costs are only defined for dispatchable generators $g \in GD$.

\begin{equation}
    \sum_{t \in T} \sum_{g \in GD} \left ( C^{comm} \cdot z_{gt} + C^{start} \cdot v_{gt} + C^{shut} \cdot w_{gt} \right ) \\
\end{equation}

\subsubsection{Day ahead generation costs}

These costs are defined for all generators $g \in G$.

\begin{equation}
    \sum_{t \in T} \sum_{g \in G} C^{var}_{g} \cdot \hat{q}_{gt}
\end{equation}

\subsubsection{Probabilistic reserve activation costs}

These are defined for all generators $g \in G$.

\begin{align}
     & + \sum_{g \in G, \; t \in T} \sum_{l \in L^+} \sum_{n \in N} \left ( P^{L^+}_{lt} \cdot \sum_{g \in G} C^{var}_{g} \cdot r^{L^+}_{glt} + C^{shed} \cdot rs_{nlt} \right ) \\
     & - \sum_{g \in G, \; t \in T} \sum_{l \in L^-} \sum_{n \in N} \left ( P^{L^-}_{lt} \cdot C^{var}_{g} \cdot r^{L^-}_{gnlt} + C^{shed} \cdot rc_{nlt} \right ) \nonumber
\end{align}

These terms attempt to take into account the expected cost of activating operating reserves. The expectation is obtained by weighting the cost of activating a particular upward reserve level $l \in L^+$ (increase in costs) or downward reserve level $l \in L^-$ (decrease in costs) by the probability of that reserve level being activated, $P^{L^+}_{lt}$ and $P^{L^-}_{lt}$ respectively.

Both upward and downward reserve levels can be `shed', i.e. not provided. In the case of upward reserves, load shedding in real time is expected so as to satisfy the power balance. In the case of downward reserves, load shedding in the day ahead stage provides the additional downward reserves. The assumption (perhaps implausible) is that this load could in fact be served i.e. not shed depending on the imbalance realisation.  Since load shedding in day ahead is the most expensive decision that the model can take, downward reserve provided in this way is a last resort, even though this term of the objective on its own leads to a decrease in objective costs.

\subsection{Constraints}

\subsubsection{Day ahead power balance}

The power balance:

\begin{equation}
    \sum_{g \in G_n} q_{gt} + \sum_{s \in S_n} (d_{st} - c_{st}) + ls_{nt} = D_{nt} + inj_{nt} \quad n \in N, \; t \in T
\end{equation}

Note the use of the set $G_n$ to only allow generators at node $n$ to contribute to the power balance (similarly for storage technologies). Another way of describing this would have been through an incidence matrix~\cite{Belderbos2020}.

\subsubsection{Limiting day ahead load shedding}

The equation below limits load shedding to the demand at that node. In copper plate systems this constraint is not needed, however in nodal systems this constraint is required as unphysical load shedding may be exploited to improve congestion (as was the case during this exercise).

\begin{equation}
    ls_{nt} \leq D_{nt} \quad n \in N, \; t \in T
\end{equation}

\subsubsection{Day ahead network constraints}

The DC power flow approximation used in this exercise is described below:

\begin{align}
    f_{bt} = \sum_{n \in N} PTDF_{nb} \cdot inj_{nt} & \quad b \in B, \; t \in T \\
    -F_b \leq f_{bt} \leq F_b                        & \quad b \in B, \; t \in T \\
    \sum_{n \in N} inj_{nt} = 0                      & \quad n \in N, \; t \in T
\end{align}

\subsubsection{Generators}

Constraints on generation:

\begin{align}
    q_{gt} - r^{-}_{gt} \geq 0                    & \quad g \in GR, \; t \in T \\
    q_{gt} + r^{+}_{gt} \leq AF_{gt} \cdot K_g    & \quad g \in GR, \; t \in T \\
    q_{gt} - r^{-}_{gt} \geq P^{min} \cdot z_{gt} & \quad g \in GD, \; t \in T \\
    q_{gt} + r^{+}_{gt} \leq P^{max} \cdot z_{gt} & \quad g \in GD, \; t \in T
\end{align}

Minimum up and down times:

\begin{align}
    1 - z_{gt} \geq \sum_{\tau \in 1:MDT_g - 1} w_{gt-\tau} & \quad g \in GD, \; t \in T_{MDT:end} \\
    z_{gt} \geq \sum_{\tau \in 1:MUT_g - 1} v_{gt-\tau}     & \quad g \in GD, \; t \in T_{MUT:end}
\end{align}

Relationship between commitment, startup and shutdown:

\begin{align}
    z_{gt-1} = z_{gt} - v_{gt} + w_{gt} & \quad g \in GD, \; t \in T_{2:end} \\
    w_{gt} + v_{gt} \leq 1              & \quad g \in GD, \; t \in T
\end{align}

Ramping constraints:

\begin{align}
    q_{gt} - q_{gt-1} + r^+_{gt} \leq RAMP_g & \quad g \in GD, \; t \in T_{2:end} \\
    q_{gt-1} - q_{gt} + r^-_{gt} \leq RAMP_g & \quad g \in GD, \; t \in T_{2:end}
\end{align}

\subsubsection{Storage}

\begin{align}
    e_{t+1} = e_t + \sqrt{\eta} \cdot c_{st} - \sqrt{\eta} \cdot d_{st} & \quad s \in S, \; t \in T_{1:end}                   \\
    e_{end} \geq e_0                                                    & \quad s \in S   \label{eq:storage_cyclic_constrant} \\
    y_{st} \cdot d_{st} \geq 0                                          & \quad s \in S, \; t \in T                           \\
    y_{st} \cdot d_{st} \leq K_s                                        & \quad s \in S, \; t \in T                           \\
    (1 - y_{st}) \cdot c_{st} \geq 0                                    & \quad s \in S, \; t \in T                           \\
    (1 - y_{st}) \cdot c_{st} \leq K_s                                  & \quad s \in S, \; t \in T
\end{align}

The binary variable $y_{st}$ prevents simultaneous charging and discharging. While such unphysical behaviour is not typical, in this case the constraint was deemed necessary since such behaviour could be exploited to reduce congestion. This was also investigated in the results, where including this binary variable is referred to as PSCD (`Prevent Simultaneous Charge / Discharge').

When carrying out this exercise it was noticed that the system being studied was very sensitive to assumptions on storage due to the high penetration of batteries (~92 GWh). Assuming that all storage technologies were empty at the beginning of the day led to load shedding at this time because the system relies on charging storage during the day. Assuming they were full led to no scarcity issues at all. Assuming they were half full sometimes led to a single spike in load shedding \emph{despite there being sufficient energy in the storage units to avoid this}. This is because of the cyclic constraint on the state of charge given by \eqref{eq:storage_cyclic_constrant}, that is that the load shedding was occurring so as to satisfy this constraint and not because there was any real scarcity.

\subsubsection{Operating reserve (activation) constraints}

The constraints on reserve provision are as follows:

\begin{align}
    D^{L^+}_{lt} = \sum_{g \in G} r^{L^+}_{glt} + \sum_{n \in N} rs_{nlt} & \quad l \in L^+, \; t \in T \\
    D^{L^-}_{lt} = \sum_{g \in G} r^{L^-}_{glt} + \sum_{n \in N} rc_{nlt} & \quad l \in L^-, \; t \in T \\
    \sum_{l \in L^-} rc_{nlt} \leq ls_{nt}                                & \quad n \in N, \; t \in T   \\
    r^{+}_{gt} = \sum_{l \in L^+} r^{L^+}_{gnlt}                          & \quad g \in G, \; t \in T   \\
    r^{-}_{gt} = \sum_{l \in L^-} r^{L^-}_{gnlt}                          & \quad g \in G, \; t \in T
\end{align}

The amount of reserve shedding can be limited to a fraction of the total upward reserve requirements $RSL$:

\begin{equation}
    \sum_{n \in N, l \in L^+} rs_{nlt} \leq RSL \cdot \sum_{l \in L^+} D^{L^+}_{lt} \quad t \in T
\end{equation}

There are several matters to note here:

\begin{itemize}
    \item The operating reserve balance is performed over the entire network, not per node.
    \item The operating reserve balance is split into reserve levels. Higher reserve levels (values of $l$) are less likely to occur.
    \item It is possible to shed upward reserves, and this is more likely to occur for higher reserve levels. This model is therefore able to make a trade-off between day ahead adequacy and real time operational security, albeit crudely.
    \item Shedding load in day ahead allows additional downward reserves to be provided through the variable $rc_{nlt}$. Implicitly this assumes that load can be `activated' in real time to provide downward reserves.
\end{itemize}

\subsubsection{Operating reserve activation network constraints} \label{sec:operating_reserve_network_activation_constraints}

The following constraints attempt to take network constraints into account (albeit very weakly):

\begin{align}
    \sum_{g \in G_n, l'=1:l} (r^{L^+}_{glt} + rs_{nlt}) = d^{L^+}_{nlt} + rinj^{L^+}_{nlt}   & \quad n \in N, \; l \in L^+, \; t \in T \label{eq:reserve_network_activation_constraints_1} \\
    - \sum_{g \in G_n, l'=1:l} (r^{L^-}_{glt} + rc_{nlt}) = d^{L^-}_{nlt} + rinj^{L^-}_{nlt} & \quad n \in N, \; l \in L^-, \; t \in T                                                     \\
    \sum_{n \in N} d^{L^+}_{nlt} = \sum_{l'=1:l} D^{L^+}_{l't}                               & \quad l \in L^+, \; t \in T                                                                 \\
    \sum_{n \in N} d^{L^-}_{nlt} = - \sum_{l'=1:l} D^{L^-}_{l't}                             & \quad l \in L^-, \; t \in T                                                                 \\
    rf^{L^+}_{blt} = \sum_{n \in N} PTDF_{nb} \cdot rinj^{L^+}_{nlt}                         & \quad b \in B, \; l \in L^+, \; t \in T                                                     \\
    rf^{L^-}_{blt} = \sum_{n \in N} PTDF_{nb} \cdot rinj^{L^-}_{nlt}                         & \quad b \in B, \; l \in L^-, \; t \in T                                                     \\
    -F_{b} \leq f_{bt} + rf^{L^+}_{blt} \leq F_b                                             & \quad b \in B, \; l \in L^+, \; t \in T                                                     \\
    -F_{b} \leq f_{bt} + rf^{L^-}_{blt} \leq F_b                                             & \quad b \in B, \; l \in L^-, \; t \in T                                                     \\
    \sum_{n \in N} rinj^{L^+}_{nt} = 0                                                       & \quad l \in L^+, \; n \in N, \; t \in T                                                     \\
    \sum_{n \in N} rinj^{L^-}_{nt} = 0                                                       & \quad l \in L^-, \; n \in N, \; t \in T \label{eq:reserve_network_activation_constraints_2}
\end{align}

Note that $rinj^{L^+}_{nlt}$, $rinj^{L^-}_{nlt}$, $d^{L^+}_{nlt}$ and $d^{L^-}_{nlt}$ are all free variables and there is a change in sign between upward and downward reserve levels to ensure that the resulting addition to the line flows, $rf^{L^+}_{blt}$ and $rf^{L^-}_{blt}$, are correct.

Since imbalances are aggregated across the network, a particular reserve level activation is not associated with an imbalance at the nodal level. The above constraints therefore enforce that for each reserve level $l$ and node $n$, \emph{there exists some combination} of nodal imbalance, node injections, generator dispatches and line flows which would satisfy the network constraints AND the imbalance across the entire network. This weakly constrains the reserve activation network flows since the optimizer is free to choose this combination.

\subsubsection{Further constraining reserve activation network constraints} \label{sec:further_constraining_operating_reserve_network_activation_constraints}

Given the formulation here, which uses reserve levels, i.e. quantiles, over the entire network to represent forecast errors, it is difficult to come up with more stringent conditions. However, we devised two ways of doing so. The first is to apply box constraints to the possible nodal imbalances:

\begin{align}
    d_{nt}^{min} \leq d_{nlt}^{L^+} \leq d_{nt}^{max} & \quad n \in N, \; l \in L^+, \; t \in T \\
    d_{nt}^{min} \leq d_{nlt}^{L^-} \leq d_{nt}^{max} & \quad n \in N, \; l \in L^-, \; t \in T
\end{align}

It is possible to calculate $d_{nt}^{min}$ and $d_{nt}^{max}$ since the quantiles for $D^{L^+}$ and $D^{L^-}$ are calculated based on forecast error scenarios which \emph{are} defined at the nodal level. These limits are shown in Figure \ref{fig:imbalance_range}. Clearly it is simply not possible to have an imbalance on some nodes, such as Coo (the location of Belgium's pumped hydro unit). Constraining $d_{nlt}^{L^+}$ and $d_{nlt}^{L^-}$ in this way is referred to as AbsImb later on.

\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\textwidth]{../plots/nodal_imbalance_investigation/imbalance_range}
    \caption{Range of possible imbalances for all hours of day 309.\label{fig:imbalance_range}}
\end{figure}

The other possibility is to restrict $d_{nlt}^{L^+}$ and $d_{nlt}^{L^-}$ to lie within the convex hull of all imbalances. This is illustrated in 2 dimensions in Figure \ref{fig:convex_hull_tihange} for the imbalances at Tihange 1 and 2. Clearly the imbalances are highly correlated, and constraining the possible nodal imbalances to lie within the convex hull exploits this in a way that box constraints would not be able to.

\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\textwidth]{../plots/nodal_imbalance_investigation/convex_hull_TIHANGE 1_TIHANGE 2}
    \caption{Illustration of convex hull constraints on $d_{nlt}^{L^+}$ and $d_{nlt}^{L^-}$. Blue circles are imbalance scenarios, shaded area is the convex hull, $d_{nt}^{min}$ and $d_{nt}^{max}$ are the x limits for TIHANGE 1 and the y limits for TIHANGE 2. \label{fig:convex_hull_tihange}}
\end{figure}

This convex hull restriction led to model infeasibilities and so it was not implemented.

\section{Input data - stylised Belgian grid with a large amount of variable renewable energy sources} \label{sec:data}

All data used for this exercise can be found \href{https://www.dropbox.com/sh/mdvmc082gwng0tr/AABRyc3fZpxAFycmUfZmh8Csa?dl=0}{here}.

The grid and resource data used for this interaction is inspired by the case study in~\cite{Belderbos2020}, omitting the gas network and power to gas technologies. This data gives a stylised Belgian system with a high penetration (~8s0\%) of \ac{VRES}, which includes 75.7 GW of solar PV, 7.0 GW of Onshore Wind and 7.3 GW of Offshore Wind. The grid consists of 46 nodes connected by 69 lines. The total amount of conventional thermal generation is 9.9 GW, with all generators based on new \ac{CCGT} units apart from one new \ac{OCGT} unit at Lixhe. The nuclear generators of Doel and Tihange are therefore replaced with new \ac{CCGT} units.

Power to Gas is omitted but 14.1 GW of storage power capacity (1.1 GW provided by pumped hydro at Coo, the rest batteries) and 101 GWh of storage energy capacity (8.2 GWh provided by pumped hydro at Coo, the rest batteries) is included. The batteries therefore have a duration of 7.2 hours (which could be considered atypical, given current durations of 1 - 2 hours~\cite{MITEI2022}).

The network topology was obtained from the Belgian TSO, Elia~\cite{Elia2018grid}. It consists of 46 nodes connected by 69 lines.

The load time series used was the load as seen by Elia on the high-voltage grid from the year 2015~\cite{Belderbos2020}. For this year, the minimum and maximum load was 5,777 MW and 13,670 MW respectively, with an average of 9,934 MW. The electrical load is assigned to the different nodes in the system according to the rated capacity of the transformer feeding each node.

The \ac{VRES} availability factor time series are taken from Elia data for the year 2015, same as the load. This was done by dividing generation from offshore wind, wind and solar by the total installed capacities available. This allows scaling up the generation of \ac{VRES} to the previously mentioned capacities. The distribution of onshore wind and solar photovoltaic (PV) capacity was done according to the distribution made in~\cite{DelarueErik2016Dtio}.

The residual load time series, aggregated across all nodes, for this system is plotted in \figref{fig:residual_load_ts}.

\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9/textwidth]{../plots/process_input/residual_load_timeseries}
    \caption{Residual load time series of test system.\label{fig:residual_load_ts}}
\end{figure}

A complete overview of the data is given in~\cite{Belderbos2020}, Appendix B.

Four days were selected for analysis based on the results of a full year economic dispatch model which included network constraints. The load was multiplied uniformly across all nodes by a factor of 1.5 to ensure that some load shedding occurred and then four days were selected which represented the 0, 33, 66 and 100th percentile in terms of daily load shedding. The resulting days are presented in \tabref{tab:day_selection}. 

\begin{table}[ht]
    \centering
    \begin{tabular}{cccc}
        \toprule
        Day ahead daily load shedding [MWh/day] & Day of year & Month & Day of month \\
        \midrule
        0                                       & 161         & 6     & 10           \\
        449                                     & 319         & 11    & 15           \\
        1,247                                   & 285         & 10    & 12           \\
        10,062                                  & 12          & 1     & 12           \\
        \bottomrule
    \end{tabular}
    \caption{Days selected for analysis. These were selected based on the results of a full year economic dispatch model with load multiplied uniformly across all nodes by a factor of 1.5. The 0, 33, 66 and 100th percentiles in terms of daily load shedding were then selected.}\label{tab:day_selection}
\end{table}

Of the four days selected, only day 285 exhibited load shedding when the load was not scaled but operating reserves were present. This finding highlights how day ahead adequacy may occur for reasons other than insufficient capacity aggregated across the network, i.e. analysis of the aggregated residual load (the load net of renewable generation) may be uninformative.

We changed the days under investigation several times during this interaction. For this reason (and also for brevity), we only analysed day 285 in detail (see \secref{sec:initial_results}) and only have a comparison of the \ac{DUCPR} and power flow results for day 309.

\section{Analysis of \acl{DUCPR} model results} \label{sec:initial_results}

This analysis relates only to the 285th day of the year (12th of October). The aim is to investigate what are the causes of load shedding to better understand the system.

\subsection{No operating reserves}

\tabref{tab:results_no_OR} lists results for an increasing level of technical constraints or increasingly inflexible system. While the objective increases by \euro 1,267,000 from the simple linear economic dispatch model with no network constraints to the unit commitment model with network constraints, no load shedding occurs. Preventing simultaneous charging and discharging constraints actually decreases, though this difference is within the optimality gap (0.01\%). This suggests that additional energy consumption (which is not physically possible) from storage does not aid congestion in this context.

\begin{table}[ht]
    \centering
    \begin{tabular}{ccccc}
        \toprule
        UC  & DANet & PSCD & Load shedding [MWh] & Objective [\euro] \\
        \midrule
            &       &      & 0.0                 & 3,127,814         \\
        \xm &       &      & 0.0                 & 4,003,654         \\
        \xm & \xm   &      & 0.0                 & 4,394,693         \\
        \xm & \xm   & \xm  & 0.0                 & 4,394,513         \\
        \bottomrule
    \end{tabular}
    \caption{Analysis of model results when operating reserves are not included. UC = Unit Commitment constraints, DANet = Day Ahead Network constraints, PSCD = Prevent Simultaneous Charging and Discharging constraints.}\label{tab:results_no_OR}
\end{table}

The dispatch aggregated over the entire network for the model with and without unit commitment constraints and with network constraints is shown in \figref{fig:dispatch_base}. The addition of unit commitment constraints leads to less storage discharging and more conventional (thermal) units generating at the start of the day. The aggregated storage state of charge at 10AM (hour 6826) is approximately the same however. The addition of network constraints does not appear to change the aggregated dispatch significantly.

\begin{figure}[H]
    \centering
    \begin{subfigure}[t]{0.7\textwidth}
        \centering
        \includegraphics[width=\textwidth]{../data/sims/main_model_runs/285/base/dispatch}
        \caption{Economic dispatch model}
    \end{subfigure}
    \begin{subfigure}[t]{0.7\textwidth}
        \centering
        \includegraphics[width=\textwidth]{../data/sims/main_model_runs/285/base_UC=true/dispatch}
        \caption{Unit commitment model}
    \end{subfigure}
    \begin{subfigure}[t]{0.7\textwidth}
        \centering
        \includegraphics[width=\textwidth]{../data/sims/main_model_runs/285/base_UC=true_DANet=true/dispatch}
        \caption{Unit commitment model with day ahead network constraints}
    \end{subfigure}
    \caption{Dispatch schedules for day 285 and increasing model complexity.\label{fig:dispatch_base}}
\end{figure}

\subsection{Probabilistic operating reserves}

\tabref{tab:results_no_RANet} summarises results for the model runs with probabilistic operating reserves but no reserve activation network constraints. Clearly unit commitment constraints lead to greatly increased load shedding, 3.8 GWh to be precise. They also lead to reserve shedding where there wasn't any before. Neither day ahead network constraints or preventing simultaneous charging or discharging have an effect on the objective function which is greater than the MIP gap.

\begin{table}[ht]
    \centering
    \footnotesize
    \begin{tabular}{ccccccc}
        \toprule
        UC  & DANet & PSCD & RSL & Load shedding [MWh] & Reserve Shedding [MWh] & Objective  \\
        \midrule
            &       &      & 0.0 & 1,575               & 0.0                    & 19,508,913 \\
            &       &      & 0.5 & 1,575               & 0.0                    & 19,508,913 \\
            &       &      & 1.0 & 1,575               & 0.0                    & 19,508,913 \\
        \midrule
        \xm &       &      & 0.0 & 5,410               & 0.0                    & 63,198,973 \\
        \xm &       &      & 0.5 & 5,410               & 5,683                  & 63,136,103 \\
        \xm &       &      & 1.0 & 5,410               & 5,616                  & 63,136,444 \\
        \midrule
        \xm & \xm   &      & 0.0 & 5,410               & 0.0                    & 63,198,620 \\
        \xm & \xm   &      & 0.5 & 5,410               & 5,440                  & 63,137,301 \\
        \xm & \xm   &      & 1.0 & 5,410               & 5,700                  & 63,140,438 \\
        \midrule
        \xm & \xm   & \xm  & 0.0 & 5,410               & 0.0                    & 63,198,858 \\
        \xm & \xm   & \xm  & 0.5 & 5,410               & 5,112                  & 63,139,965 \\
        \xm & \xm   & \xm  & 1.0 & 5,410               & 5,114                  & 63,140,337 \\
        \bottomrule
    \end{tabular}
    \caption{Analysis of model results with operating reserves but no reserve activation network constraints. UC = Unit Commitment constraints, DANet = Day Ahead Network constraints, PSCD = Prevent Simultaneous Charging and Discharging constraints, RSL = Reserve Shedding Limit.}\label{tab:results_no_RANet}
\end{table}

\figref{fig:dispatch_with_operating_reserves} shows the dispatch schedule for the case with unit commitment constraints, day ahead network constraints and operating reserve requirements but no limit on reserve shedding. Load shedding occurs at 8 - 10 AM, even though there is still energy in the storage units. This is not due to congestion issues, since some of these storage units are located at the same node as the load being shed. Rather, this is likely due to the constraint which specifies that the storage state of charge at the end of the day must be greater than or equal to that at the start of the day. This constraint was included so as not to overestimate the flexibility that storage could provide, though it is unlikely that such a situation would occur in reality.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{../data/sims/main_model_runs/285/base_UC=true_DANet=true_RSV=1.0/dispatch}
    \caption{Dispatch schedule for day 285, unit commitment constraints, day ahead network constraints and operating reserve requirements but no limit on reserve shedding.\label{fig:dispatch_with_operating_reserves}}
\end{figure}

Considering the case with just unit commitment constraints, the reserve shedding limit can be decreased without increasing load shedding, though there is an increase (~0.09\%) in the objective function greater than the MIP gap. This is counterintuitive, as you would expect the DUC-PR model to shed all operating reserves before shedding load in the day ahead stage. The former is less costly than the latter after all, due to activation probabilities being < 1. However, what is occuring is most likely `economic reserve shedding' - shedding reserves because they are highly unlikely to be activated. This phenomenon was also observed in~\cite{Hermans2018}. \figref{fig:reserves_with_operating_reserves} illustrates that almost all reserve shedding occurs between 14:00 and 16:00 (hour 6830 to 6832) and not 8:00 to 10:00 as with load shedding. These are hours with a lot of solar generation and very little conventional, so to avoid this reserve shedding only requires additional generator commitment and not increasing the amount of load shedding in those hours.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{../data/sims/main_model_runs/285/base_UC=true_DANet=true_RSV=1.0/reserves}
    \caption{Dispatch schedule for day 285, unit commitment constraints, day ahead network constraints and operating reserve requirements but no limit on reserve shedding.\label{fig:reserves_with_operating_reserves}}
\end{figure}

\subsection{Probabilistic operating reserves with reserve activation network constraints}

Including network reserve activation constraints, that is Constraints \ref{eq:reserve_network_activation_constraints_1} through \ref{eq:reserve_network_activation_constraints_2}, led to no discernible changes in objective value within the 0.01\% MIP gap, as can be seen from \tabref{tab:results_with_RANet} (see the difference between first three and second three rows). Similarly including absolute limits on the nodal imbalance realisations has very little effect on the results.

\begin{table}[ht]
    \centering
    \tiny
    \begin{tabular}{ccccccccc}
        \toprule
        UC  & DANet & PSCD & RANet & AbsImb & RSL & Load shedding [MWh] & Reserve Shedding [MWh] & Objective [\euro] (MIP Gap [\%]) \\
        \midrule
        \xm & \xm   & \xm  &       &        & 0.0 & 5,410               & 0.0                    & 63,198,858                       \\
        \xm & \xm   & \xm  &       &        & 0.5 & 5,410               & 5,112                  & 63,139,965                       \\
        \xm & \xm   & \xm  &       &        & 1.0 & 5,410               & 5,114                  & 63,140,337                       \\
        \midrule
        \xm & \xm   & \xm  & \xm   &        & 0.0 & 5,410               & 0                      & 63,199,116                       \\
        \xm & \xm   & \xm  & \xm   &        & 0.5 & 5,410               & 4,898                  & 63,139,874                       \\
        \xm & \xm   & \xm  & \xm   &        & 1.0 & 5,410               & 5,611                  & 63,137,767                       \\
        \midrule
        \xm & \xm   & \xm  & \xm   & \xm    & 0.0 & 5,410               & 0                      & 63,232,938 (0.04)
        )                                                                                                                           \\
        \xm & \xm   & \xm  & \xm   & \xm    & 0.5 & 5,410               & 5,687                  & 63,150,183                       \\
        \xm & \xm   & \xm  & \xm   & \xm    & 1.0 & 5,410               & 6,452                  & 63,155,353 (0.02)                \\
        \bottomrule
    \end{tabular}
    \caption{Analysis of model results with operating reserves, with and without reserve activation network constraints and with and without absolute limits on nodal imbalances. MIP gap is shown in the case where this was greater than 0.01\%. UC = Unit Commitment constraints, DANet = Day Ahead Network constraints, PSCD = Prevent Simultaneous Charging and Discharging constraints, RANet = Reserve Activation Network constraints, AbsImb = Absolute limits on nodal Imbalance realisation, RSL = Reserve Shedding Limit.}\label{tab:results_with_RANet}
\end{table}

Multiplying the load by a factor of 1.5 gives the results shown in \tabref{tab:results_with_RANet_LM_15}. Here it is possible to discern a trade-off between load shedding and reserve shedding, albeit a small one - reducing reserve shedding to 0 from approximately 12,000 MWh increases load shedding only by 914 MWh. That this effect is slight is for similar reasons to that listed previously - reserve shedding occurs in different hours to load shedding and load shedding occurs in the same hours as before (8:00 to 11:00) and is likely due to the cyclic constraint on storage.

\begin{table}[ht]
    \centering
    \tiny
    \begin{tabular}{ccccccccc}
        \toprule
        UC  & DANet & PSCD & RANet & AbsImb & RSL & Load shedding [MWh] & Reserve Shedding [MWh] & Objective [\euro] (MIP Gap [\%]) \\
        \midrule
            &       &      & \xm   &        & 0.0 & 5,825               & 0.0                    & 69,902,500                       \\
        \xm &       &      & \xm   &        & 0.0 & 5,825               & 0.0                    & 77,491,233                       \\
        \xm & \xm   &      & \xm   &        & 0.0 & 6,314               & 0.0                    & 82,523,020                       \\
        \xm & \xm   & \xm  & \xm   &        & 0.0 & 6,314               & 0.0                    & 82,523,020                       \\
        \midrule
        \xm & \xm   & \xm  & \xm   &        & 0.0 & 6,314               & 0.0                    & 82,523,020                       \\
        \xm & \xm   & \xm  & \xm   &        & 0.5 & 5,410               & 12,187                 & 72,771,511                       \\
        \xm & \xm   & \xm  & \xm   &        & 1.0 & 5,410               & 12,244                 & 72,771,897                       \\
        \midrule
        \xm & \xm   & \xm  & \xm   & \xm    & 0.0 & 6,314               & 0                      & 83,163,868                       \\
        \xm & \xm   & \xm  & \xm   & \xm    & 0.5 & 5,410               & 13,115                 & 73,298,008                       \\
        \xm & \xm   & \xm  & \xm   & \xm    & 1.0 & 5,410               & 13,430                 & 73,296,805                       \\
        \bottomrule
    \end{tabular}
    \caption{Analysis of model results with operating reserves, with and without reserve activation network constraints and with and without absolute limits on nodal imbalances and for load multiplied by a factor of 1.5. MIP gap is shown in the case where this was greater than 0.01\%. UC = Unit Commitment constraints, DANet = Day Ahead Network constraints, PSCD = Prevent Simultaneous Charging and Discharging constraints, RANet = Reserve Activation Network constraints, AbsImb = Absolute limits on nodal Imbalance realisation, RSL = Reserve Shedding Limit.}\label{tab:results_with_RANet_LM_15}
\end{table}

\section{Day ahead adequacy and real time operational security trade offs} \label{sec:adequacy_vs_security}

\subsection{Simple illustrative case}

We begin by illustrating the tradeoff that exists between real time load shedding and day ahead reserve shedding with a simple model. No network or unit commitment constraints are included and no storage either. The latter choice is made since in this model formulation storage is not able to contribute to operating reserve requirements, complicating the interpretation of the results. The results are shown in \figref{fig:simple_reserve_vs_load_shedding}.

\begin{figure}[h]
    \centering
    \begin{subfigure}[t]{0.9\textwidth}
        \centering
        \includegraphics[width=\textwidth]{../plots/copperplate_adequacy_security_tradeoff/load_shedding_vs_reserve_shedding}
        \caption{Reserve shedding plotted as a function of load shedding}
    \end{subfigure}
    \begin{subfigure}[t]{0.9\textwidth}
        \centering
        \includegraphics[width=\textwidth]{../plots/copperplate_adequacy_security_tradeoff/load_shedding_vs_expected_load_shedding}
        \caption{Expected additional real time load shedding (reserve shedding weighted by activation probability) plotted as a function of load shedding.}
    \end{subfigure}
\caption{Simple illustration of the potential trade-off between planned load shedding (i.e. day ahead adequacy) and expected load shedding (i.e. real time operational security). Results are for day 161, no storage, unit commitment or network constraints are included.\label{fig:simple_reserve_vs_load_shedding}}
\end{figure}

\figref{fig:simple_reserve_vs_load_shedding} is included here to illustrate the trade-off we wanted to be able to investigate. However, for the reasons described in \secref{sec:initial_results} and \bref{sec:ULiege_comparison}, this was not possible.

\subsection{Comparison with ULiege operational security results} \label{sec:ULiege_comparison}

A comparison of the real time operational security as percieved by the DUC-PR model compared to those obtained from a power flow performed by the team ULiege is given in the figure below.

\begin{figure}[h]
    \centering
    \begin{subfigure}[t]{0.9\textwidth}
        \centering
        \includegraphics[width=\textwidth]{../plots/compare_ULiege_results/forecast_only_no_contingency.pdf}
        \caption{Day ahead load shedding for DUC-PR and operational security power flow model.}
    \end{subfigure}
    \begin{subfigure}[t]{0.9\textwidth}
        \centering
        \includegraphics[width=\textwidth]{../plots/compare_ULiege_results/with_scenarios_no_contingency.pdf}
        \caption{Expected load shedding for DUC-PR and operational security power flow model.}
    \end{subfigure}
\caption{Results are for day 309, with storage, unit commitment and network (reserve activation) constraints.\label{fig:Uliege_compare}}
\end{figure}

Clearly the two models disagree. We suggest the following non-exhaustive list of reasons why this could be:

\begin{itemize}
    \item The approximate modeling of real time imbalances in the DUC-PR model (see \secref{sec:operating_reserve_network_activation_constraints} and \secref{sec:further_constraining_operating_reserve_network_activation_constraints}). As extensively discussed, this means the DUC-PR model overestimates the ease with which real time imbalances may be dealt with.
    \item The omission of N-1 contingencies in the DUC-PR model. This omission also leads to an overestimation of the ease of dealing with real time imbalances.
    \item The extra-liberty for storage to deal with real time imbalances in ULiege's power flow model. This has the opposite effect.
\end{itemize}

While the remark regarding storage could be resolved by allowing for storage to contribute to operating reserves as in \cite{Bruninx2016}, the remaining two issues are non-trivial to address in the DUC-PR framework. A stochastic unit commitment model, in which real time imbalances are fully defined within a scenario, would lend itself more easily to addressing these issues while coming at considerable computational cost.

\section{Reflections on future work}

Were an attempt at integrating an adequacy assessment and operational security analysis to be done again, it is my humble opinion that this should be done on a very simple system to begin with. Such a simple system would consist of only a few nodes (e.g. 3) and without complicating technologies such as storage. A preliminary analysis could validate the agreement between the unit commitment and power flow model in an initial step, followed by increasing the complexity of the model and input data, e.g. including more forecast error scenarios and storage. As noted in this report, the \ac{DUCPR} model appears to be unable to account for real time nodal imbalances due to the way it models operating reserves (i.e. aggregating all forecast error scenarios over all nodes into one net load forecast error distribution for the entire system). A stochastic unit commitment would be therefore better suited for such an exercise, though this comes at the cost of dealing with the computational complexity of such a model.

\clearpage

\bibliography{bibliography}

\end{document}
